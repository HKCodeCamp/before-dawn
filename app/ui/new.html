<!DOCTYPE html>
<html>
  <head>
    <title>About!</title>
    <link href="photon.min.css" rel="stylesheet" type="text/css" />
    <link href="styles.css" rel="stylesheet" type="text/css" />
  </head>

  <body>
    <div class="window new">
      <div class="window-content">
        <form>
          <fieldset>
            <div class="form-group">
              <label for="name">Name:</label>
              <input type="text" name="name" class="form-control" placeholder="" />
              <div class="hint">The name of your screensaver.</div>
            </div>
            <div class="form-group">
              <label for="name">Description:</label>
              <input type="text" name="description" class="form-control" placeholder="" />
              <div class="hint">A brief description of your screensaver.</div>
            </div>
            <div class="form-group">
              <label for="aboutUrl">About URL:</label>
              <input type="text" name="aboutUrl" class="form-control" placeholder="" />
              <div class="hint">If you have a URL with more details about your work, put it here!</div>
            </div>
            <div class="form-group">
              <label for="author">Author:</label>
              <input type="text" name="author" class="form-control" placeholder="" />
              <div class="hint">The author of this screensaver.</div>
            </div>
          </fieldset>
        </form>
      </div>
      <footer class="toolbar toolbar-footer">
        <div class="pull-right">
          <button class="btn btn-large btn-default cancel">Cancel</button>
          <button class="btn btn-large btn-positive save">Save</button>
        </div>
      </footer>
    </div>
  </body>
  
  <script>
   var remote = window.require('electron').remote;
   var exec = require('child_process').exec;
   var savers = remote.getGlobal('savers');
   
   var closeWindow = function() {
     var window = remote.getCurrentWindow();
     window.close();
   };

   var handleSave = function() {   
     var name = document.querySelector("[name=name]").value;
     var description = document.querySelector("[name=description]").value;     
     var aboutUrl = document.querySelector("[name=aboutUrl]").value;     
     var author = document.querySelector("[name=author]").value;
     
     var dest = savers.generateScreensaver({
       name: name,
       description: description,
       aboutUrl: aboutUrl,
       author: author
     });

     openFolderInOS(dest);
     closeWindow();
   };

   var openFolderInOS = function(f) {
     var cmd;
     switch(process.platform) {
       case 'darwin':
         cmd = `open -R ${f}`;
         break;
       case 'win32':
         if (process.env.SystemRoot) {
           cmd = path.join(process.env.SystemRoot, 'explorer.exe');
         }
         else {
           cmd = 'explorer.exe';
         }

         cmd = cmd + ` /select,${f}`;
         break;
       default:
         // # Strip the filename from the path to make sure we pass a directory
         // # path. If we pass xdg-open a file path, it will open that file in the
         // # most suitable application instead, which is not what we want.
         cmd = `xdg-open ${f}`;
     };

     exec(cmd, function(error, stdout, stderr) {
       console.log('stdout: ' + stdout);
       console.log('stderr: ' + stderr);
       if (error !== null) {
         console.log('exec error: ' + error);
       }
     });

   };
   
   document.querySelector(".cancel").addEventListener('click', closeWindow, false);
   document.querySelector(".save").addEventListener('click', handleSave, false);
  </script>
</html>
